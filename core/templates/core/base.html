{# Archivo: core/templates/core/base.html #}
{% load static %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:"es" }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TravelHub Agencia{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/branding.css' %}">
    <link rel="stylesheet" href="{% static 'css/layout.css' %}">
    <meta name="theme-color" content="#333333">
    {% block extra_head %}{% endblock %}
</head>
<body>
    <header class="site-header">
        <div class="site-header__inner">
            <div class="brand-logo">
                <a href="{% url 'core:home' %}">
                    <img src="{% static 'images/SVG/LOGO.svg' %}" alt="TravelHub Logo" />
                    <span>TravelHub</span>
                </a>
            </div>
            <button id="themeToggle" class="btn btn--ghost" type="button" aria-label="Alternar tema" title="Alternar tema">üåô</button>
        </div>
    </header>

    <div id="layoutShell" class="layout-shell layout-shell--with-left">
        <aside id="appSidebar" class="app-sidebar" aria-label="Barra lateral principal">
            <div class="app-sidebar__top">
                <button id="sidebarCollapseBtn" class="sidebar-collapse-btn" type="button" aria-label="Colapsar" title="Colapsar"></button>
                <button id="sidebarMobileClose" class="sidebar-mobile-close" type="button" aria-label="Cerrar men√∫">√ó</button>
            </div>
            <nav class="app-nav" aria-label="Men√∫ principal">
                <p class="app-nav__label">General</p>
                <ul class="app-nav__list">
                    <li><a class="app-nav__link" href="{% url 'core:home' %}">Inicio</a></li>
                    <li><a class="app-nav__link" href="{% url 'core:lista_paquetes_cms' %}">Paquetes</a></li>
                    <li><a class="app-nav__link" href="/admin/">Admin</a></li>
                </ul>
                <p class="app-nav__label">Boletos</p>
                <ul class="app-nav__list">
                    <li><a class="app-nav__link" href="{% url 'core:dashboard_boletos' %}">Dashboard Boletos</a></li>
                    <li><a class="app-nav__link" href="{% url 'core:manual_ticket_entry' %}">Nuevo Boleto Manual</a></li>
                </ul>
                <p class="app-nav__label">Ventas</p>
                <ul class="app-nav__list">
                    <li><a class="app-nav__link" href="{% url 'core:dashboard_resumen_ventas' %}">Resumen por Categor√≠a</a></li>
                    <li><a class="app-nav__link" href="{% url 'core:air_tickets_editable' %}">Boleter√≠a A√©rea (Editar)</a></li>
                </ul>
                <p class="app-nav__label">Extras</p>
                <ul class="app-nav__list">
                    <li><a class="app-nav__link app-nav__link--disabled" href="#">Reportes (pr√≥x.)</a></li>
                    <li><a class="app-nav__link app-nav__link--disabled" href="#">Estad√≠sticas (pr√≥x.)</a></li>
                </ul>
                <div class="app-sidebar__metrics">
                    <h5>M√©tricas</h5>
                    <ul>
                        <li>Total: <strong id="mTotalBoletos">‚Äî</strong></li>
                        <li>Completados: <strong id="mBoletosCom">‚Äî</strong></li>
                        <li>Errores: <strong id="mBoletosErr">‚Äî</strong></li>
                    </ul>
                </div>
            </nav>
            <div class="app-sidebar__footer">UI 1.2 ‚Ä¢ Beta</div>
        </aside>
        <main class="layout-main fade-in" id="mainContent">
            {% if messages %}
                <div class="messages-container">
                    {% for message in messages %}
                        <div class="message {{ message.tags }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            <button id="sidebarMobileOpen" class="sidebar-mobile-open" type="button" aria-label="Abrir men√∫">‚ò∞</button>
            {% block content %}
            <p>Bienvenido a TravelHub. Contenido por defecto.</p>
            {% endblock %}
        </main>
    </div>
    <footer class="site-footer">
        <div class="site-footer__inner">
            <div>
                <h4 class="mb-1">TravelHub</h4>
                <p class="mb-2">Agencia de viajes: emisi√≥n de boletos, reservas y experiencias personalizadas.</p>
                <p class="small-note">Tel: +58 412 3312314<br>Mail: travelinkeo@gmail.com</p>
            </div>
            <div>
                <h5 class="mb-1">Navegaci√≥n</h5>
                <ul class="nav-simple-list">
                    <li><a href="{% url 'core:home' %}">Inicio</a></li>
                    <li><a href="{% url 'core:lista_paquetes_cms' %}">Paquetes</a></li>
                    <li><a href="/admin/">Admin</a></li>
                </ul>
            </div>
            <div>
                <h5 class="mb-1">Legal</h5>
                <p class="legal-block">T√©rminos y condiciones<br>Pol√≠tica de privacidad<br>Cookies</p>
            </div>
        </div>
        <div class="footer-bottom">&copy; {% now "Y" %} TravelHub Agencia. Todos los derechos reservados.</div>
        </footer>
        <script nonce="{{ csp_nonce }}">
        (function(){
            // Dark mode
            const STORAGE_KEY = 'th_theme';
            const root = document.documentElement;
            const btn = document.getElementById('themeToggle');
            const apply = (mode) => {
                if(mode === 'dark'){ root.classList.add('theme-dark'); btn.textContent='‚òÄÔ∏è'; }
                else { root.classList.remove('theme-dark'); btn.textContent='üåô'; }
            };
            const stored = localStorage.getItem(STORAGE_KEY);
            if(stored){ apply(stored); }
            else if(window.matchMedia('(prefers-color-scheme: dark)').matches){ apply('dark'); }
            btn && btn.addEventListener('click', () => {
                const next = root.classList.contains('theme-dark') ? 'light' : 'dark';
                apply(next);
                localStorage.setItem(STORAGE_KEY, next);
            });
        })();

    (function(){
            const sidebar = document.getElementById('appSidebar');
            const collapseBtn = document.getElementById('sidebarCollapseBtn');
            const mobileOpen = document.getElementById('sidebarMobileOpen');
            const mobileClose = document.getElementById('sidebarMobileClose');
            const STATE_KEY = 'th.sidebar.state';
            if(!sidebar) return;

            function applyDesktopState(state){
                if(state==='collapsed'){ sidebar.classList.add('is-collapsed'); }
                else { sidebar.classList.remove('is-collapsed'); }
            }

            function loadState(){
                const v = localStorage.getItem(STATE_KEY);
                if(window.matchMedia('(max-width: 991px)').matches){ return; }
                if(v) applyDesktopState(v);
            }
            loadState();

            collapseBtn && collapseBtn.addEventListener('click', ()=>{
                const collapsed = sidebar.classList.toggle('is-collapsed');
                localStorage.setItem(STATE_KEY, collapsed ? 'collapsed':'expanded');
            });

            mobileOpen && mobileOpen.addEventListener('click', ()=>{
                sidebar.classList.add('is-open');
                document.body.classList.add('has-offcanvas');
            });
            mobileClose && mobileClose.addEventListener('click', ()=>{
                sidebar.classList.remove('is-open');
                document.body.classList.remove('has-offcanvas');
            });

            // Close on backdrop click
            document.addEventListener('click', (e)=>{
                if(window.matchMedia('(min-width: 992px)').matches) return;
                if(sidebar.classList.contains('is-open')){
                    if(!sidebar.contains(e.target) && !mobileOpen.contains(e.target)){
                        sidebar.classList.remove('is-open');
                        document.body.classList.remove('has-offcanvas');
                    }
                }
            });
    })();
        </script>

        {% block extra_js %}{% endblock %}
</body>
</html>
